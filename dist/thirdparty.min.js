!function(){"use strict";var t="1.0.0",e=1;if(!Object.create)var i=function(){};var n=Array.prototype.slice,r={attributes:{},eventHandlers:{"-1":{}},guid:-1,addEvent:function(t){r.eventHandlers[t.guid][t.type]||(r.eventHandlers[t.guid][t.type]=[]),r.eventHandlers[t.guid][t.type].push({guid:t.guid,handler:t.handler,scope:t.scope,type:t.type})},addEventHandler:function(t,e,i){var n,s={};"string"==typeof t?(n=i||!1,s[t]=e):(n=e||!1,s=t);for(var o in s)for(var u=s[o],a=o.split(" "),h=0,l=a.length;h<l;h++){var c=a[h];r.addEvent.call(this,{guid:this._guid||this._.guid,handler:u,scope:n,type:c})}},addGuid:function(t,i){t._guid&&!i||(t._guid=e++,r.attributes[t._guid]={},r.eventHandlers[t._guid]={})},attr:function(t){return r.attributes[t]},clone:function(t){var e=r.typeOf(t);return"object"===e?r.extend({},t):"array"===e?t.slice(0):void 0},create:function(t){return Object.create?Object.create(t):(i.prototype=t,new i)},createSubclass:function(t,e){function i(){if(!(this instanceof i))throw new Error("Please use 'new' when initializing Stapes classes");this.on&&r.addGuid(this,!0),o.apply(this,arguments)}t=t||{},e=e||!1;var n=t.superclass.prototype,o=t.hasOwnProperty("constructor")?t.constructor:function(){};e&&r.extend(n,s),i.prototype=r.create(n),i.prototype.constructor=i,r.extend(i,{extend:function(){return r.extendThis.apply(this,arguments)},parent:n,proto:function(){return r.extendThis.apply(this.prototype,arguments)},subclass:function(t){return t=t||{},t.superclass=this,r.createSubclass(t)}});for(var u in t)"constructor"!==u&&"superclass"!==u&&(i.prototype[u]=t[u]);return i},emitEvents:function(t,e,i,s){i=i||!1,s=s||this._guid;for(var o=n.call(r.eventHandlers[s][t]),u=0,a=o.length;u<a;u++){var h=r.extend({},o[u]),l=h.scope?h.scope:this;i&&(h.type=i),h.scope=l,h.handler.call(h.scope,e,h)}},extend:function(){for(var t=n.call(arguments),e=t.shift(),i=0,r=t.length;i<r;i++){var s=t[i];for(var o in s)e[o]=s[o]}return e},extendThis:function(){var t=n.call(arguments);return t.unshift(this),r.extend.apply(this,t)},makeUuid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0,i="x"==t?e:3&e|8;return i.toString(16)})},removeAttribute:function(t,e){e=e||!1;for(var i=r.trim(t).split(" "),n={},s=0,o=i.length;s<o;s++){var u=r.trim(i[s]);u&&(n.key=u,n.oldValue=r.attr(this._guid)[u],delete r.attr(this._guid)[u],e||(this.emit("change",u),this.emit("change:"+u),this.emit("mutate",n),this.emit("mutate:"+u,n),this.emit("remove",u),this.emit("remove:"+u)),delete n.oldValue)}},removeEventHandler:function(t,e){var i=r.eventHandlers[this._guid];if(t&&e){if(i=i[t],!i)return;for(var n,s=0,o=i.length;s<o;s++)n=i[s].handler,n&&n===e&&(i.splice(s--,1),o--)}else t?delete i[t]:r.eventHandlers[this._guid]={}},setAttribute:function(t,e,i){i=i||!1;var n=this.has(t),s=r.attr(this._guid)[t];if(e!==s&&(r.attr(this._guid)[t]=e,!i)){this.emit("change",t),this.emit("change:"+t,e);var o={key:t,newValue:e,oldValue:"undefined"!=typeof s?s:null};this.emit("mutate",o),this.emit("mutate:"+t,o);var u=n?"update":"create";this.emit(u,t),this.emit(u+":"+t,e)}},trim:function(t){return t.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},typeOf:function(t){return null===t||"undefined"==typeof t?String(t):Object.prototype.toString.call(t).replace(/\[object |\]/g,"").toLowerCase()},updateAttribute:function(t,e,i){var n=this.get(t),s=r.typeOf(n);"object"!==s&&"array"!==s||(n=r.clone(n));var o=e.call(this,n,t);r.setAttribute.call(this,t,o,i||!1)}},s={emit:function(t,e){e="undefined"==typeof e?null:e;for(var i=t.split(" "),n=0,s=i.length;n<s;n++){var o=i[n];r.eventHandlers[-1].all&&r.emitEvents.call(this,"all",e,o,-1),r.eventHandlers[-1][o]&&r.emitEvents.call(this,o,e,o,-1),"number"==typeof this._guid&&(r.eventHandlers[this._guid].all&&r.emitEvents.call(this,"all",e,o),r.eventHandlers[this._guid][o]&&r.emitEvents.call(this,o,e))}},off:function(){r.removeEventHandler.apply(this,arguments)},on:function(){r.addEventHandler.apply(this,arguments)}};r.Module=function(){},r.Module.prototype={each:function(t,e){var i=r.attr(this._guid);for(var n in i){var s=i[n];t.call(e||this,s,n)}},extend:function(){return r.extendThis.apply(this,arguments)},filter:function(t){var e=[],i=r.attr(this._guid);for(var n in i)t.call(this,i[n],n)&&e.push(i[n]);return e},get:function(t){if("string"==typeof t){if(arguments.length>1){for(var e={},i=0,n=arguments.length;i<n;i++){var s=arguments[i];e[s]=this.get(s)}return e}return this.has(t)?r.attr(this._guid)[t]:null}if("function"==typeof t){var o=this.filter(t);return o.length?o[0]:null}},getAll:function(){return r.clone(r.attr(this._guid))},getAllAsArray:function(){var t=[],e=r.attr(this._guid);for(var i in e){var n=e[i];"object"!==r.typeOf(n)||n.id||(n.id=i),t.push(n)}return t},has:function(t){return"undefined"!=typeof r.attr(this._guid)[t]},map:function(t,e){var i=[];return this.each(function(n,r){i.push(t.call(e||this,n,r))},e||this),i},push:function(t,e){if("array"===r.typeOf(t))for(var i=0,n=t.length;i<n;i++)r.setAttribute.call(this,r.makeUuid(),t[i],e||!1);else r.setAttribute.call(this,r.makeUuid(),t,e||!1);return this},remove:function(t,e){return"undefined"==typeof t?(r.attributes[this._guid]={},this.emit("change remove")):"function"==typeof t?this.each(function(i,n){t(i)&&r.removeAttribute.call(this,n,e)}):r.removeAttribute.call(this,t,e||!1),this},set:function(t,e,i){if("object"==typeof t)for(var n in t)r.setAttribute.call(this,n,t[n],e||!1);else r.setAttribute.call(this,t,e,i||!1);return this},size:function(){var t=0,e=r.attr(this._guid);for(var i in e)t++;return t},update:function(t,e,i){return"string"==typeof t?r.updateAttribute.call(this,t,e,i||!1):"function"==typeof t&&this.each(function(e,i){r.updateAttribute.call(this,i,t)}),this}};var o={_:r,extend:function(){return r.extendThis.apply(r.Module.prototype,arguments)},mixinEvents:function(t){return t=t||{},r.addGuid(t),r.extend(t,s)},on:function(){r.addEventHandler.apply(this,arguments)},subclass:function(t,e){return e=e||!1,t=t||{},t.superclass=e?function(){}:r.Module,r.createSubclass(t,!e)},version:t};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=o),exports.Stapes=o):"function"==typeof define&&define.amd?define(function(){return o}):window.Stapes=o}(),function(){"use strict";function t(t){return"function"==typeof t||"object"==typeof t&&null!==t}function e(t){return"function"==typeof t}function i(t){z=t}function n(t){W=t}function r(){return function(){process.nextTick(h)}}function s(){return function(){q(h)}}function o(){var t=0,e=new J(h),i=document.createTextNode("");return e.observe(i,{characterData:!0}),function(){i.data=t=++t%2}}function u(){var t=new MessageChannel;return t.port1.onmessage=h,function(){t.port2.postMessage(0)}}function a(){return function(){setTimeout(h,1)}}function h(){for(var t=0;t<Q;t+=2){var e=tt[t],i=tt[t+1];e(i),tt[t]=void 0,tt[t+1]=void 0}Q=0}function l(){try{var t=require,e=t("vertx");return q=e.runOnLoop||e.runOnContext,s()}catch(i){return a()}}function c(t,e){var i=this,n=new this.constructor(d);void 0===n[nt]&&N(n);var r=i._state;if(r){var s=arguments[r-1];W(function(){j(r,n,s,i._result)})}else T(i,n,t,e);return n}function p(t){var e=this;if(t&&"object"==typeof t&&t.constructor===e)return t;var i=new e(d);return x(i,t),i}function d(){}function f(){return new TypeError("You cannot resolve a promise with itself")}function v(){return new TypeError("A promises callback cannot return that same promise.")}function b(t){try{return t.then}catch(e){return ut.error=e,ut}}function y(t,e,i,n){try{t.call(e,i,n)}catch(r){return r}}function m(t,e,i){W(function(t){var n=!1,r=y(i,e,function(i){n||(n=!0,e!==i?x(t,i):k(t,i))},function(e){n||(n=!0,E(t,e))},"Settle: "+(t._label||" unknown promise"));!n&&r&&(n=!0,E(t,r))},t)}function g(t,e){e._state===st?k(t,e._result):e._state===ot?E(t,e._result):T(e,void 0,function(e){x(t,e)},function(e){E(t,e)})}function w(t,i,n){i.constructor===t.constructor&&n===et&&constructor.resolve===it?g(t,i):n===ut?E(t,ut.error):void 0===n?k(t,i):e(n)?m(t,i,n):k(t,i)}function x(e,i){e===i?E(e,f()):t(i)?w(e,i,b(i)):k(e,i)}function _(t){t._onerror&&t._onerror(t._result),A(t)}function k(t,e){t._state===rt&&(t._result=e,t._state=st,0!==t._subscribers.length&&W(A,t))}function E(t,e){t._state===rt&&(t._state=ot,t._result=e,W(_,t))}function T(t,e,i,n){var r=t._subscribers,s=r.length;t._onerror=null,r[s]=e,r[s+st]=i,r[s+ot]=n,0===s&&t._state&&W(A,t)}function A(t){var e=t._subscribers,i=t._state;if(0!==e.length){for(var n,r,s=t._result,o=0;o<e.length;o+=3)n=e[o],r=e[o+i],n?j(i,n,r,s):r(s);t._subscribers.length=0}}function O(){this.error=null}function P(t,e){try{return t(e)}catch(i){return at.error=i,at}}function j(t,i,n,r){var s,o,u,a,h=e(n);if(h){if(s=P(n,r),s===at?(a=!0,o=s.error,s=null):u=!0,i===s)return void E(i,v())}else s=r,u=!0;i._state!==rt||(h&&u?x(i,s):a?E(i,o):t===st?k(i,s):t===ot&&E(i,s))}function S(t,e){try{e(function(e){x(t,e)},function(e){E(t,e)})}catch(i){E(t,i)}}function B(){return ht++}function N(t){t[nt]=ht++,t._state=void 0,t._result=void 0,t._subscribers=[]}function R(t){return new ft(this,t).promise}function U(t){var e=this;return new e(G(t)?function(i,n){for(var r=t.length,s=0;s<r;s++)e.resolve(t[s]).then(i,n)}:function(t,e){e(new TypeError("You must pass an array to race."))})}function V(t){var e=this,i=new e(d);return E(i,t),i}function H(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function C(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function F(t){this[nt]=B(),this._result=this._state=void 0,this._subscribers=[],d!==t&&("function"!=typeof t&&H(),this instanceof F?S(this,t):C())}function D(t,e){this._instanceConstructor=t,this.promise=new t(d),this.promise[nt]||N(this.promise),G(e)?(this._input=e,this.length=e.length,this._remaining=e.length,this._result=new Array(this.length),0===this.length?k(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&k(this.promise,this._result))):E(this.promise,M())}function M(){return new Error("Array Methods must be provided an Array")}function L(){var t;if("undefined"!=typeof global)t=global;else if("undefined"!=typeof self)t=self;else try{t=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var i=t.Promise;i&&"[object Promise]"===Object.prototype.toString.call(i.resolve())&&!i.cast||(t.Promise=dt)}var I;I=Array.isArray?Array.isArray:function(t){return"[object Array]"===Object.prototype.toString.call(t)};var q,z,$,G=I,Q=0,W=function(t,e){tt[Q]=t,tt[Q+1]=e,Q+=2,2===Q&&(z?z(h):$())},Y="undefined"!=typeof window?window:void 0,X=Y||{},J=X.MutationObserver||X.WebKitMutationObserver,K="undefined"==typeof self&&"undefined"!=typeof process&&"[object process]"==={}.toString.call(process),Z="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,tt=new Array(1e3);$=K?r():J?o():Z?u():void 0===Y&&"function"==typeof require?l():a();var et=c,it=p,nt=Math.random().toString(36).substring(16),rt=void 0,st=1,ot=2,ut=new O,at=new O,ht=0,lt=R,ct=U,pt=V,dt=F;F.all=lt,F.race=ct,F.resolve=it,F.reject=pt,F._setScheduler=i,F._setAsap=n,F._asap=W,F.prototype={constructor:F,then:et,"catch":function(t){return this.then(null,t)}};var ft=D;D.prototype._enumerate=function(){for(var t=this.length,e=this._input,i=0;this._state===rt&&i<t;i++)this._eachEntry(e[i],i)},D.prototype._eachEntry=function(t,e){var i=this._instanceConstructor,n=i.resolve;if(n===it){var r=b(t);if(r===et&&t._state!==rt)this._settledAt(t._state,e,t._result);else if("function"!=typeof r)this._remaining--,this._result[e]=t;else if(i===dt){var s=new i(d);w(s,t,r),this._willSettleAt(s,e)}else this._willSettleAt(new i(function(e){e(t)}),e)}else this._willSettleAt(n(t),e)},D.prototype._settledAt=function(t,e,i){var n=this.promise;n._state===rt&&(this._remaining--,t===ot?E(n,i):this._result[e]=i),0===this._remaining&&k(n,this._result)},D.prototype._willSettleAt=function(t,e){var i=this;T(t,void 0,function(t){i._settledAt(st,e,t)},function(t){i._settledAt(ot,e,t)})};var vt=L,bt={Promise:dt,polyfill:vt};"function"==typeof define&&define.amd?define(function(){return bt}):"undefined"!=typeof module&&module.exports?module.exports=bt:"undefined"!=typeof this&&(this.ES6Promise=bt),vt()}.call(this),function(t){"use strict";function e(t){if("string"!=typeof t&&(t=String(t)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(t))throw new TypeError("Invalid character in header field name");return t.toLowerCase()}function i(t){return"string"!=typeof t&&(t=String(t)),t}function n(t){var e={next:function(){var e=t.shift();return{done:void 0===e,value:e}}};return v.iterable&&(e[Symbol.iterator]=function(){return e}),e}function r(t){this.map={},t instanceof r?t.forEach(function(t,e){this.append(e,t)},this):t&&Object.getOwnPropertyNames(t).forEach(function(e){this.append(e,t[e])},this)}function s(t){return t.bodyUsed?Promise.reject(new TypeError("Already read")):void(t.bodyUsed=!0)}function o(t){return new Promise(function(e,i){t.onload=function(){e(t.result)},t.onerror=function(){i(t.error)}})}function u(t){var e=new FileReader;return e.readAsArrayBuffer(t),o(e)}function a(t){var e=new FileReader;return e.readAsText(t),o(e)}function h(){return this.bodyUsed=!1,this._initBody=function(t){if(this._bodyInit=t,"string"==typeof t)this._bodyText=t;else if(v.blob&&Blob.prototype.isPrototypeOf(t))this._bodyBlob=t;else if(v.formData&&FormData.prototype.isPrototypeOf(t))this._bodyFormData=t;else if(v.searchParams&&URLSearchParams.prototype.isPrototypeOf(t))this._bodyText=t.toString();else if(t){if(!v.arrayBuffer||!ArrayBuffer.prototype.isPrototypeOf(t))throw new Error("unsupported BodyInit type")}else this._bodyText="";this.headers.get("content-type")||("string"==typeof t?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):v.searchParams&&URLSearchParams.prototype.isPrototypeOf(t)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},v.blob?(this.blob=function(){var t=s(this);if(t)return t;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this.blob().then(u)},this.text=function(){var t=s(this);if(t)return t;if(this._bodyBlob)return a(this._bodyBlob);if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)}):this.text=function(){var t=s(this);return t?t:Promise.resolve(this._bodyText)},v.formData&&(this.formData=function(){return this.text().then(p)}),this.json=function(){return this.text().then(JSON.parse)},this}function l(t){var e=t.toUpperCase();return b.indexOf(e)>-1?e:t}function c(t,e){e=e||{};var i=e.body;if(c.prototype.isPrototypeOf(t)){if(t.bodyUsed)throw new TypeError("Already read");this.url=t.url,this.credentials=t.credentials,e.headers||(this.headers=new r(t.headers)),this.method=t.method,this.mode=t.mode,i||(i=t._bodyInit,t.bodyUsed=!0)}else this.url=t;if(this.credentials=e.credentials||this.credentials||"omit",!e.headers&&this.headers||(this.headers=new r(e.headers)),this.method=l(e.method||this.method||"GET"),this.mode=e.mode||this.mode||null,this.referrer=null,("GET"===this.method||"HEAD"===this.method)&&i)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(i)}function p(t){var e=new FormData;return t.trim().split("&").forEach(function(t){if(t){var i=t.split("="),n=i.shift().replace(/\+/g," "),r=i.join("=").replace(/\+/g," ");e.append(decodeURIComponent(n),decodeURIComponent(r))}}),e}function d(t){var e=new r,i=(t.getAllResponseHeaders()||"").trim().split("\n");return i.forEach(function(t){var i=t.trim().split(":"),n=i.shift().trim(),r=i.join(":").trim();e.append(n,r)}),e}function f(t,e){e||(e={}),this.type="default",this.status=e.status,this.ok=this.status>=200&&this.status<300,this.statusText=e.statusText,this.headers=e.headers instanceof r?e.headers:new r(e.headers),this.url=e.url||"",this._initBody(t)}if(!t.fetch){var v={searchParams:"URLSearchParams"in t,iterable:"Symbol"in t&&"iterator"in Symbol,blob:"FileReader"in t&&"Blob"in t&&function(){try{return new Blob,!0}catch(t){return!1}}(),formData:"FormData"in t,arrayBuffer:"ArrayBuffer"in t};r.prototype.append=function(t,n){t=e(t),n=i(n);var r=this.map[t];r||(r=[],this.map[t]=r),r.push(n)},r.prototype["delete"]=function(t){delete this.map[e(t)]},r.prototype.get=function(t){var i=this.map[e(t)];return i?i[0]:null},r.prototype.getAll=function(t){return this.map[e(t)]||[]},r.prototype.has=function(t){return this.map.hasOwnProperty(e(t))},r.prototype.set=function(t,n){this.map[e(t)]=[i(n)]},r.prototype.forEach=function(t,e){Object.getOwnPropertyNames(this.map).forEach(function(i){this.map[i].forEach(function(n){t.call(e,n,i,this)},this)},this)},r.prototype.keys=function(){var t=[];return this.forEach(function(e,i){t.push(i)}),n(t)},r.prototype.values=function(){var t=[];return this.forEach(function(e){t.push(e)}),n(t)},r.prototype.entries=function(){var t=[];return this.forEach(function(e,i){t.push([i,e])}),n(t)},v.iterable&&(r.prototype[Symbol.iterator]=r.prototype.entries);var b=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];c.prototype.clone=function(){return new c(this)},h.call(c.prototype),h.call(f.prototype),f.prototype.clone=function(){return new f(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new r(this.headers),url:this.url})},f.error=function(){var t=new f(null,{status:0,statusText:""});return t.type="error",t};var y=[301,302,303,307,308];f.redirect=function(t,e){if(y.indexOf(e)===-1)throw new RangeError("Invalid status code");return new f(null,{status:e,headers:{location:t}})},t.Headers=r,t.Request=c,t.Response=f,t.fetch=function(t,e){return new Promise(function(i,n){function r(){return"responseURL"in o?o.responseURL:/^X-Request-URL:/m.test(o.getAllResponseHeaders())?o.getResponseHeader("X-Request-URL"):void 0}var s;s=c.prototype.isPrototypeOf(t)&&!e?t:new c(t,e);var o=new XMLHttpRequest;o.onload=function(){var t={status:o.status,statusText:o.statusText,headers:d(o),url:r()},e="response"in o?o.response:o.responseText;i(new f(e,t))},o.onerror=function(){n(new TypeError("Network request failed"))},o.ontimeout=function(){n(new TypeError("Network request failed"))},o.open(s.method,s.url,!0),"include"===s.credentials&&(o.withCredentials=!0),"responseType"in o&&v.blob&&(o.responseType="blob"),s.headers.forEach(function(t,e){o.setRequestHeader(e,t)}),o.send("undefined"==typeof s._bodyInit?null:s._bodyInit)})},t.fetch.polyfill=!0}}("undefined"!=typeof self?self:this),function(){function t(t,i,n,r){return new e(t,i,n,r)}function e(t,e,n,r){this.options=r||{},this.options.adapters=this.options.adapters||{},this.obj=t,this.keypath=e,this.callback=n,this.objectPath=[],this.parse(),i(this.target=this.realize())&&this.set(!0,this.key,this.target,this.callback)}function i(t){return"object"==typeof t&&null!==t}function n(t){throw new Error("[sightglass] "+t)}t.adapters={},e.tokenize=function(t,e,i){var n,r,s=[],o={i:i,path:""};for(n=0;n<t.length;n++)r=t.charAt(n),~e.indexOf(r)?(s.push(o),o={i:r,path:""}):o.path+=r;return s.push(o),s},e.prototype.parse=function(){var i,r,s=this.interfaces();s.length||n("Must define at least one adapter interface."),~s.indexOf(this.keypath[0])?(i=this.keypath[0],r=this.keypath.substr(1)):("undefined"==typeof(i=this.options.root||t.root)&&n("Must define a default root adapter."),r=this.keypath),this.tokens=e.tokenize(r,s,i),this.key=this.tokens.pop()},e.prototype.realize=function(){var t,e=this.obj,n=!1;return this.tokens.forEach(function(r,s){i(e)?("undefined"!=typeof this.objectPath[s]?e!==(t=this.objectPath[s])&&(this.set(!1,r,t,this.update.bind(this)),this.set(!0,r,e,this.update.bind(this)),this.objectPath[s]=e):(this.set(!0,r,e,this.update.bind(this)),this.objectPath[s]=e),e=this.get(r,e)):(n===!1&&(n=s),(t=this.objectPath[s])&&this.set(!1,r,t,this.update.bind(this)))},this),n!==!1&&this.objectPath.splice(n),e},e.prototype.update=function(){var t,e;(t=this.realize())!==this.target&&(i(this.target)&&this.set(!1,this.key,this.target,this.callback),i(t)&&this.set(!0,this.key,t,this.callback),e=this.value(),this.target=t,this.value()!==e&&this.callback())},e.prototype.value=function(){if(i(this.target))return this.get(this.key,this.target)},e.prototype.setValue=function(t){i(this.target)&&this.adapter(this.key).set(this.target,this.key.path,t)},e.prototype.get=function(t,e){return this.adapter(t).get(e,t.path)},e.prototype.set=function(t,e,i,n){var r=t?"observe":"unobserve";this.adapter(e)[r](i,e.path,n)},e.prototype.interfaces=function(){var e=Object.keys(this.options.adapters);return Object.keys(t.adapters).forEach(function(t){~e.indexOf(t)||e.push(t)}),e},e.prototype.adapter=function(e){return this.options.adapters[e.i]||t.adapters[e.i]},e.prototype.unobserve=function(){var t;this.tokens.forEach(function(e,i){(t=this.objectPath[i])&&this.set(!1,e,t,this.update.bind(this))},this),i(this.target)&&this.set(!1,this.key,this.target,this.callback)},"undefined"!=typeof module&&module.exports?module.exports=t:"function"==typeof define&&define.amd?define([],function(){return this.sightglass=t}):this.sightglass=t}.call(this),function(){var t,e,i,n,r=function(t,e){return function(){return t.apply(e,arguments)}},s=[].slice,o={}.hasOwnProperty,u=function(t,e){function i(){this.constructor=t}for(var n in e)o.call(e,n)&&(t[n]=e[n]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},a=[].indexOf||function(t){for(var e=0,i=this.length;e<i;e++)if(e in this&&this[e]===t)return e;return-1};t={options:["prefix","templateDelimiters","rootInterface","preloadData","handler","executeFunctions"],extensions:["binders","formatters","components","adapters"],"public":{binders:{},components:{},formatters:{},adapters:{},prefix:"rv",templateDelimiters:["{","}"],rootInterface:".",preloadData:!0,executeFunctions:!1,iterationAlias:function(t){return"%"+t+"%"},handler:function(t,e,i){return this.call(t,e,i.view.models)},configure:function(e){var i,n,r,s;null==e&&(e={});for(r in e)if(s=e[r],"binders"===r||"components"===r||"formatters"===r||"adapters"===r)for(n in s)i=s[n],t[r][n]=i;else t["public"][r]=s},bind:function(e,i,n){var r;return null==i&&(i={}),null==n&&(n={}),r=new t.View(e,i,n),r.bind(),r},init:function(e,i,n){var r,s,o;if(null==n&&(n={}),null==i&&(i=document.createElement("div")),e=t["public"].components[e],s=e.template.call(this,i),s instanceof HTMLElement){for(;i.firstChild;)i.removeChild(i.firstChild);i.appendChild(s)}else i.innerHTML=s;return r=e.initialize.call(this,i,n),o=new t.View(i,r),o.bind(),o}}},window.jQuery||window.$?(n="on"in jQuery.prototype?["on","off"]:["bind","unbind"],e=n[0],i=n[1],t.Util={bindEvent:function(t,i,n){return jQuery(t)[e](i,n)},unbindEvent:function(t,e,n){return jQuery(t)[i](e,n)},getInputValue:function(t){var e;return e=jQuery(t),"checkbox"===e.attr("type")?e.is(":checked"):e.val()}}):t.Util={bindEvent:function(){return"addEventListener"in window?function(t,e,i){return t.addEventListener(e,i,!1)}:function(t,e,i){return t.attachEvent("on"+e,i)}}(),unbindEvent:function(){return"removeEventListener"in window?function(t,e,i){return t.removeEventListener(e,i,!1)}:function(t,e,i){return t.detachEvent("on"+e,i)}}(),getInputValue:function(t){var e,i,n,r;if("checkbox"===t.type)return t.checked;if("select-multiple"===t.type){for(r=[],i=0,n=t.length;i<n;i++)e=t[i],e.selected&&r.push(e.value);return r}return t.value}},t.TypeParser=function(){function t(){}return t.types={primitive:0,keypath:1},t.parse=function(t){return/^'.*'$|^".*"$/.test(t)?{type:this.types.primitive,value:t.slice(1,-1)}:"true"===t?{type:this.types.primitive,value:!0}:"false"===t?{type:this.types.primitive,value:!1}:"null"===t?{type:this.types.primitive,value:null}:"undefined"===t?{type:this.types.primitive,value:void 0}:""===t?{type:this.types.primitive,value:void 0}:isNaN(Number(t))===!1?{type:this.types.primitive,value:Number(t)}:{type:this.types.keypath,value:t}},t}(),t.TextTemplateParser=function(){function t(){}return t.types={text:0,binding:1},t.parse=function(t,e){var i,n,r,s,o,u,a;for(u=[],s=t.length,i=0,n=0;n<s;){if(i=t.indexOf(e[0],n),i<0){u.push({type:this.types.text,value:t.slice(n)});break}if(i>0&&n<i&&u.push({type:this.types.text,value:t.slice(n,i)}),n=i+e[0].length,i=t.indexOf(e[1],n),i<0){o=t.slice(n-e[1].length),r=u[u.length-1],(null!=r?r.type:void 0)===this.types.text?r.value+=o:u.push({type:this.types.text,value:o});break}a=t.slice(n,i).trim(),u.push({type:this.types.binding,value:a}),n=i+e[1].length}return u},t}(),t.View=function(){function e(e,i,n){var s,o,u,a,h,l,c,p,d,f,v,b,y;for(this.els=e,this.models=i,null==n&&(n={}),this.update=r(this.update,this),this.publish=r(this.publish,this),this.sync=r(this.sync,this),this.unbind=r(this.unbind,this),this.bind=r(this.bind,this),this.select=r(this.select,this),this.traverse=r(this.traverse,this),this.build=r(this.build,this),this.buildBinding=r(this.buildBinding,this),this.bindingRegExp=r(this.bindingRegExp,this),this.options=r(this.options,this),this.els.jquery||this.els instanceof Array||(this.els=[this.els]),d=t.extensions,h=0,c=d.length;h<c;h++){if(o=d[h],this[o]={},n[o]){f=n[o];for(s in f)u=f[s],this[o][s]=u}v=t["public"][o];for(s in v)u=v[s],null==(a=this[o])[s]&&(a[s]=u)}for(b=t.options,l=0,p=b.length;l<p;l++)o=b[l],this[o]=null!=(y=n[o])?y:t["public"][o];this.build()}return e.prototype.options=function(){var e,i,n,r,s;for(i={},s=t.extensions.concat(t.options),n=0,r=s.length;n<r;n++)e=s[n],i[e]=this[e];return i},e.prototype.bindingRegExp=function(){return new RegExp("^"+this.prefix+"-")},e.prototype.buildBinding=function(e,i,n,r){var s,o,u,a,h,l,c;return h={},c=function(){var t,e,i,n;for(i=r.match(/((?:'[^']*')*(?:(?:[^\|']*(?:'[^']*')+[^\|']*)+|[^\|]+))|^$/g),n=[],t=0,e=i.length;t<e;t++)l=i[t],n.push(l.trim());return n}(),s=function(){var t,e,i,n;for(i=c.shift().split("<"),n=[],t=0,e=i.length;t<e;t++)o=i[t],n.push(o.trim());return n}(),a=s.shift(),h.formatters=c,(u=s.shift())&&(h.dependencies=u.split(/\s+/)),this.bindings.push(new t[e](this,i,n,a,h))},e.prototype.build=function(){var e,i,n,r,s;for(this.bindings=[],i=function(e){return function(n){var r,s,o,u,a,h,l,c,p,d,f,v,b;if(3===n.nodeType){if(a=t.TextTemplateParser,(o=e.templateDelimiters)&&(c=a.parse(n.data,o)).length&&(1!==c.length||c[0].type!==a.types.text)){for(p=0,f=c.length;p<f;p++)l=c[p],h=document.createTextNode(l.value),n.parentNode.insertBefore(h,n),1===l.type&&e.buildBinding("TextBinding",h,null,l.value);n.parentNode.removeChild(n)}}else 1===n.nodeType&&(r=e.traverse(n));if(!r)for(b=function(){var t,e,i,r;for(i=n.childNodes,r=[],t=0,e=i.length;t<e;t++)u=i[t],r.push(u);return r}(),d=0,v=b.length;d<v;d++)s=b[d],i(s)}}(this),s=this.els,n=0,r=s.length;n<r;n++)e=s[n],i(e);this.bindings.sort(function(t,e){var i,n;return((null!=(i=e.binder)?i.priority:void 0)||0)-((null!=(n=t.binder)?n.priority:void 0)||0)})},e.prototype.traverse=function(e){var i,n,r,s,o,u,a,h,l,c,p,d,f,v,b,y;for(s=this.bindingRegExp(),o="SCRIPT"===e.nodeName||"STYLE"===e.nodeName,v=e.attributes,c=0,d=v.length;c<d;c++)if(i=v[c],s.test(i.name)){if(h=i.name.replace(s,""),!(r=this.binders[h])){b=this.binders;for(u in b)l=b[u],"*"!==u&&u.indexOf("*")!==-1&&(a=new RegExp("^"+u.replace(/\*/g,".+")+"$"),a.test(h)&&(r=l))}r||(r=this.binders["*"]),r.block&&(o=!0,n=[i])}for(y=n||e.attributes,p=0,f=y.length;p<f;p++)i=y[p],s.test(i.name)&&(h=i.name.replace(s,""),this.buildBinding("Binding",e,h,i.value));return o||(h=e.nodeName.toLowerCase(),this.components[h]&&!e._bound&&(this.bindings.push(new t.ComponentBinding(this,e,h)),o=!0)),o},e.prototype.select=function(t){var e,i,n,r,s;for(r=this.bindings,s=[],i=0,n=r.length;i<n;i++)e=r[i],t(e)&&s.push(e);return s},e.prototype.bind=function(){var t,e,i,n;for(n=this.bindings,e=0,i=n.length;e<i;e++)t=n[e],t.bind()},e.prototype.unbind=function(){var t,e,i,n;for(n=this.bindings,e=0,i=n.length;e<i;e++)t=n[e],t.unbind()},e.prototype.sync=function(){var t,e,i,n;for(n=this.bindings,e=0,i=n.length;e<i;e++)t=n[e],"function"==typeof t.sync&&t.sync()},e.prototype.publish=function(){var t,e,i,n;for(n=this.select(function(t){var e;return null!=(e=t.binder)?e.publishes:void 0}),e=0,i=n.length;e<i;e++)t=n[e],t.publish()},e.prototype.update=function(t){var e,i,n,r,s,o;null==t&&(t={});for(i in t)n=t[i],this.models[i]=n;for(o=this.bindings,r=0,s=o.length;r<s;r++)e=o[r],"function"==typeof e.update&&e.update(t)},e}(),t.Binding=function(){function e(t,e,i,n,s){this.view=t,this.el=e,this.type=i,this.keypath=n,this.options=null!=s?s:{},this.getValue=r(this.getValue,this),this.update=r(this.update,this),this.unbind=r(this.unbind,this),this.bind=r(this.bind,this),this.publish=r(this.publish,this),this.sync=r(this.sync,this),this.set=r(this.set,this),this.eventHandler=r(this.eventHandler,this),this.formattedValue=r(this.formattedValue,this),this.parseFormatterArguments=r(this.parseFormatterArguments,this),this.parseTarget=r(this.parseTarget,this),this.observe=r(this.observe,this),this.setBinder=r(this.setBinder,this),this.formatters=this.options.formatters||[],this.dependencies=[],this.formatterObservers={},this.model=void 0,this.setBinder()}return e.prototype.setBinder=function(){var t,e,i,n;if(!(this.binder=this.view.binders[this.type])){n=this.view.binders;for(t in n)i=n[t],"*"!==t&&t.indexOf("*")!==-1&&(e=new RegExp("^"+t.replace(/\*/g,".+")+"$"),e.test(this.type)&&(this.binder=i,this.args=new RegExp("^"+t.replace(/\*/g,"(.+)")+"$").exec(this.type),this.args.shift()))}if(this.binder||(this.binder=this.view.binders["*"]),this.binder instanceof Function)return this.binder={routine:this.binder}},e.prototype.observe=function(e,i,n){return t.sightglass(e,i,n,{root:this.view.rootInterface,adapters:this.view.adapters})},e.prototype.parseTarget=function(){var e;return e=t.TypeParser.parse(this.keypath),e.type===t.TypeParser.types.primitive?this.value=e.value:(this.observer=this.observe(this.view.models,this.keypath,this.sync),this.model=this.observer.target)},e.prototype.parseFormatterArguments=function(e,i){var n,r,s,o,u,a,h;for(e=function(){var i,n,s;for(s=[],i=0,n=e.length;i<n;i++)r=e[i],s.push(t.TypeParser.parse(r));return s}(),o=[],n=a=0,h=e.length;a<h;n=++a)r=e[n],o.push(r.type===t.TypeParser.types.primitive?r.value:((u=this.formatterObservers)[i]||(u[i]={}),(s=this.formatterObservers[i][n])?void 0:(s=this.observe(this.view.models,r.value,this.sync),this.formatterObservers[i][n]=s),s.value()));return o},e.prototype.formattedValue=function(t){var e,i,n,r,o,u,a,h,l;for(h=this.formatters,i=u=0,a=h.length;u<a;i=++u)n=h[i],e=n.match(/[^\s']+|'([^']|'[^\s])*'|"([^"]|"[^\s])*"/g),r=e.shift(),n=this.view.formatters[r],o=this.parseFormatterArguments(e,i),(null!=n?n.read:void 0)instanceof Function?t=(l=n.read).call.apply(l,[this.model,t].concat(s.call(o))):n instanceof Function&&(t=n.call.apply(n,[this.model,t].concat(s.call(o))));return t},e.prototype.eventHandler=function(t){var e,i;return i=(e=this).view.handler,function(n){return i.call(t,this,n,e)}},e.prototype.set=function(e){var i;return e=e instanceof Function&&!this.binder["function"]&&t["public"].executeFunctions?this.formattedValue(e.call(this.model)):this.formattedValue(e),null!=(i=this.binder.routine)?i.call(this,this.el,e):void 0},e.prototype.sync=function(){var t,e;return this.set(function(){var i,n,r,s,o,u,a;if(this.observer){if(this.model!==this.observer.target){for(o=this.dependencies,i=0,r=o.length;i<r;i++)e=o[i],e.unobserve();if(this.dependencies=[],null!=(this.model=this.observer.target)&&(null!=(u=this.options.dependencies)?u.length:void 0))for(a=this.options.dependencies,n=0,s=a.length;n<s;n++)t=a[n],
e=this.observe(this.model,t,this.sync),this.dependencies.push(e)}return this.observer.value()}return this.value}.call(this))},e.prototype.publish=function(){var t,e,i,n,r,o,u,a,h,l,c,p,d;if(this.observer){for(a=this.getValue(this.el),o=this.formatters.length-1,c=this.formatters.slice(0).reverse(),i=h=0,l=c.length;h<l;i=++h)n=c[i],e=o-i,t=n.split(/\s+/),r=t.shift(),u=this.parseFormatterArguments(t,e),(null!=(p=this.view.formatters[r])?p.publish:void 0)&&(a=(d=this.view.formatters[r]).publish.apply(d,[a].concat(s.call(u))));return this.observer.setValue(a)}},e.prototype.bind=function(){var t,e,i,n,r,s,o;if(this.parseTarget(),null!=(r=this.binder.bind)&&r.call(this,this.el),null!=this.model&&(null!=(s=this.options.dependencies)?s.length:void 0))for(o=this.options.dependencies,i=0,n=o.length;i<n;i++)t=o[i],e=this.observe(this.model,t,this.sync),this.dependencies.push(e);if(this.view.preloadData)return this.sync()},e.prototype.unbind=function(){var t,e,i,n,r,s,o,u,a,h;for(null!=(o=this.binder.unbind)&&o.call(this,this.el),null!=(u=this.observer)&&u.unobserve(),a=this.dependencies,r=0,s=a.length;r<s;r++)n=a[r],n.unobserve();this.dependencies=[],h=this.formatterObservers;for(i in h){e=h[i];for(t in e)n=e[t],n.unobserve()}return this.formatterObservers={}},e.prototype.update=function(t){var e,i;return null==t&&(t={}),this.model=null!=(e=this.observer)?e.target:void 0,null!=(i=this.binder.update)?i.call(this,t):void 0},e.prototype.getValue=function(e){return this.binder&&null!=this.binder.getValue?this.binder.getValue.call(this,e):t.Util.getInputValue(e)},e}(),t.ComponentBinding=function(e){function i(e,i,n){var s,o,u,h,l,c,p,d;for(this.view=e,this.el=i,this.type=n,this.unbind=r(this.unbind,this),this.bind=r(this.bind,this),this.locals=r(this.locals,this),this.component=this.view.components[this.type],this["static"]={},this.observers={},this.upstreamObservers={},o=e.bindingRegExp(),p=this.el.attributes||[],l=0,c=p.length;l<c;l++)s=p[l],o.test(s.name)||(u=this.camelCase(s.name),h=t.TypeParser.parse(s.value),a.call(null!=(d=this.component["static"])?d:[],u)>=0?this["static"][u]=s.value:h.type===t.TypeParser.types.primitive?this["static"][u]=h.value:this.observers[u]=s.value)}return u(i,e),i.prototype.sync=function(){},i.prototype.update=function(){},i.prototype.publish=function(){},i.prototype.locals=function(){var t,e,i,n,r,s;i={},r=this["static"];for(t in r)n=r[t],i[t]=n;s=this.observers;for(t in s)e=s[t],i[t]=e.value();return i},i.prototype.camelCase=function(t){return t.replace(/-([a-z])/g,function(t){return t[1].toUpperCase()})},i.prototype.bind=function(){var e,i,n,r,s,o,u,a,h,l,c,p,d,f,v,b,y,m,g,w;if(!this.bound){f=this.observers;for(i in f)n=f[i],this.observers[i]=this.observe(this.view.models,n,function(t){return function(e){return function(){return t.componentView.models[e]=t.observers[e].value()}}}(this).call(this,i));this.bound=!0}if(null!=this.componentView)this.componentView.bind();else{for(this.el.innerHTML=this.component.template.call(this),u=this.component.initialize.call(this,this.el,this.locals()),this.el._bound=!0,o={},v=t.extensions,l=0,p=v.length;l<p;l++){if(s=v[l],o[s]={},this.component[s]){b=this.component[s];for(e in b)a=b[e],o[s][e]=a}y=this.view[s];for(e in y)a=y[e],null==(h=o[s])[e]&&(h[e]=a)}for(m=t.options,c=0,d=m.length;c<d;c++)s=m[c],o[s]=null!=(g=this.component[s])?g:this.view[s];this.componentView=new t.View(Array.prototype.slice.call(this.el.childNodes),u,o),this.componentView.bind(),w=this.observers;for(i in w)r=w[i],this.upstreamObservers[i]=this.observe(this.componentView.models,i,function(t){return function(e,i){return function(){return i.setValue(t.componentView.models[e])}}}(this).call(this,i,r))}},i.prototype.unbind=function(){var t,e,i,n,r;i=this.upstreamObservers;for(t in i)e=i[t],e.unobserve();n=this.observers;for(t in n)e=n[t],e.unobserve();return null!=(r=this.componentView)?r.unbind.call(this):void 0},i}(t.Binding),t.TextBinding=function(t){function e(t,e,i,n,s){this.view=t,this.el=e,this.type=i,this.keypath=n,this.options=null!=s?s:{},this.sync=r(this.sync,this),this.formatters=this.options.formatters||[],this.dependencies=[],this.formatterObservers={}}return u(e,t),e.prototype.binder={routine:function(t,e){return t.data=null!=e?e:""}},e.prototype.sync=function(){return e.__super__.sync.apply(this,arguments)},e}(t.Binding),t["public"].binders.text=function(t,e){return null!=t.textContent?t.textContent=null!=e?e:"":t.innerText=null!=e?e:""},t["public"].binders.html=function(t,e){return t.innerHTML=null!=e?e:""},t["public"].binders.show=function(t,e){return t.style.display=e?"":"none"},t["public"].binders.hide=function(t,e){return t.style.display=e?"none":""},t["public"].binders.enabled=function(t,e){return t.disabled=!e},t["public"].binders.disabled=function(t,e){return t.disabled=!!e},t["public"].binders.checked={publishes:!0,priority:2e3,bind:function(e){return t.Util.bindEvent(e,"change",this.publish)},unbind:function(e){return t.Util.unbindEvent(e,"change",this.publish)},routine:function(t,e){var i;return"radio"===t.type?t.checked=(null!=(i=t.value)?i.toString():void 0)===(null!=e?e.toString():void 0):t.checked=!!e}},t["public"].binders.unchecked={publishes:!0,priority:2e3,bind:function(e){return t.Util.bindEvent(e,"change",this.publish)},unbind:function(e){return t.Util.unbindEvent(e,"change",this.publish)},routine:function(t,e){var i;return"radio"===t.type?t.checked=(null!=(i=t.value)?i.toString():void 0)!==(null!=e?e.toString():void 0):t.checked=!e}},t["public"].binders.value={publishes:!0,priority:3e3,bind:function(e){if("INPUT"!==e.tagName||"radio"!==e.type)return this.event="SELECT"===e.tagName?"change":"input",t.Util.bindEvent(e,this.event,this.publish)},unbind:function(e){if("INPUT"!==e.tagName||"radio"!==e.type)return t.Util.unbindEvent(e,this.event,this.publish)},routine:function(t,e){var i,n,r,s,o,u,h;if("INPUT"===t.tagName&&"radio"===t.type)return t.setAttribute("value",e);if(null!=window.jQuery){if(t=jQuery(t),(null!=e?e.toString():void 0)!==(null!=(s=t.val())?s.toString():void 0))return t.val(null!=e?e:"")}else if("select-multiple"===t.type){if(null!=e){for(h=[],n=0,r=t.length;n<r;n++)i=t[n],h.push(i.selected=(o=i.value,a.call(e,o)>=0));return h}}else if((null!=e?e.toString():void 0)!==(null!=(u=t.value)?u.toString():void 0))return t.value=null!=e?e:""}},t["public"].binders["if"]={block:!0,priority:4e3,bind:function(t){var e,i;if(null==this.marker)return e=[this.view.prefix,this.type].join("-").replace("--","-"),i=t.getAttribute(e),this.marker=document.createComment(" rivets: "+this.type+" "+i+" "),this.bound=!1,t.removeAttribute(e),t.parentNode.insertBefore(this.marker,t),t.parentNode.removeChild(t)},unbind:function(){if(this.nested)return this.nested.unbind(),this.bound=!1},routine:function(e,i){var n,r,s,o;if(!!i==!this.bound){if(i){s={},o=this.view.models;for(n in o)r=o[n],s[n]=r;return(this.nested||(this.nested=new t.View(e,s,this.view.options()))).bind(),this.marker.parentNode.insertBefore(e,this.marker.nextSibling),this.bound=!0}return e.parentNode.removeChild(e),this.nested.unbind(),this.bound=!1}},update:function(t){var e;return null!=(e=this.nested)?e.update(t):void 0}},t["public"].binders.unless={block:!0,priority:4e3,bind:function(e){return t["public"].binders["if"].bind.call(this,e)},unbind:function(){return t["public"].binders["if"].unbind.call(this)},routine:function(e,i){return t["public"].binders["if"].routine.call(this,e,!i)},update:function(e){return t["public"].binders["if"].update.call(this,e)}},t["public"].binders["on-*"]={"function":!0,priority:1e3,unbind:function(e){if(this.handler)return t.Util.unbindEvent(e,this.args[0],this.handler)},routine:function(e,i){return this.handler&&t.Util.unbindEvent(e,this.args[0],this.handler),t.Util.bindEvent(e,this.args[0],this.handler=this.eventHandler(i))}},t["public"].binders["each-*"]={block:!0,priority:4e3,bind:function(t){var e,i,n,r,s;if(null==this.marker)e=[this.view.prefix,this.type].join("-").replace("--","-"),this.marker=document.createComment(" rivets: "+this.type+" "),this.iterated=[],t.removeAttribute(e),t.parentNode.insertBefore(this.marker,t),t.parentNode.removeChild(t);else for(s=this.iterated,n=0,r=s.length;n<r;n++)i=s[n],i.bind()},unbind:function(t){var e,i,n,r;if(null!=this.iterated)for(r=this.iterated,i=0,n=r.length;i<n;i++)e=r[i],e.unbind()},routine:function(e,i){var n,r,s,o,u,a,h,l,c,p,d,f,v,b,y,m,g,w,x,_;if(h=this.args[0],i=i||[],this.iterated.length>i.length)for(w=Array(this.iterated.length-i.length),f=0,y=w.length;f<y;f++)s=w[f],d=this.iterated.pop(),d.unbind(),this.marker.parentNode.removeChild(d.els[0]);for(o=v=0,m=i.length;v<m;o=++v)if(a=i[o],r={index:o},r[t["public"].iterationAlias(h)]=o,r[h]=a,null==this.iterated[o]){x=this.view.models;for(u in x)a=x[u],null==r[u]&&(r[u]=a);c=this.iterated.length?this.iterated[this.iterated.length-1].els[0]:this.marker,l=this.view.options(),l.preloadData=!0,p=e.cloneNode(!0),d=new t.View(p,r,l),d.bind(),this.iterated.push(d),this.marker.parentNode.insertBefore(p,c.nextSibling)}else this.iterated[o].models[h]!==a&&this.iterated[o].update(r);if("OPTION"===e.nodeName)for(_=this.view.bindings,b=0,g=_.length;b<g;b++)n=_[b],n.el===this.marker.parentNode&&"value"===n.type&&n.sync()},update:function(t){var e,i,n,r,s,o,u;e={};for(i in t)n=t[i],i!==this.args[0]&&(e[i]=n);for(u=this.iterated,s=0,o=u.length;s<o;s++)r=u[s],r.update(e)}},t["public"].binders["class-*"]=function(t,e){var i;if(i=" "+t.className+" ",!e==(i.indexOf(" "+this.args[0]+" ")!==-1))return t.className=e?""+t.className+" "+this.args[0]:i.replace(" "+this.args[0]+" "," ").trim()},t["public"].binders["*"]=function(t,e){return null!=e?t.setAttribute(this.type,e):t.removeAttribute(this.type)},t["public"].formatters.call=function(){var t,e;return e=arguments[0],t=2<=arguments.length?s.call(arguments,1):[],e.call.apply(e,[this].concat(s.call(t)))},t["public"].adapters["."]={id:"_rv",counter:0,weakmap:{},weakReference:function(t){var e,i,n;return t.hasOwnProperty(this.id)||(e=this.counter++,Object.defineProperty(t,this.id,{value:e})),(i=this.weakmap)[n=t[this.id]]||(i[n]={callbacks:{}})},cleanupWeakReference:function(t,e){if(!(Object.keys(t.callbacks).length||t.pointers&&Object.keys(t.pointers).length))return delete this.weakmap[e]},stubFunction:function(t,e){var i,n,r;return n=t[e],i=this.weakReference(t),r=this.weakmap,t[e]=function(){var e,s,o,u,a,h,l,c,p,d;u=n.apply(t,arguments),l=i.pointers;for(o in l)for(s=l[o],d=null!=(c=null!=(p=r[o])?p.callbacks[s]:void 0)?c:[],a=0,h=d.length;a<h;a++)(e=d[a])();return u}},observeMutations:function(t,e,i){var n,r,s,o,u,h;if(Array.isArray(t)){if(s=this.weakReference(t),null==s.pointers)for(s.pointers={},r=["push","pop","shift","unshift","sort","reverse","splice"],u=0,h=r.length;u<h;u++)n=r[u],this.stubFunction(t,n);if(null==(o=s.pointers)[e]&&(o[e]=[]),a.call(s.pointers[e],i)<0)return s.pointers[e].push(i)}},unobserveMutations:function(t,e,i){var n,r,s;if(Array.isArray(t)&&null!=t[this.id]&&(r=this.weakmap[t[this.id]])&&(s=r.pointers[e]))return(n=s.indexOf(i))>=0&&s.splice(n,1),s.length||delete r.pointers[e],this.cleanupWeakReference(r,t[this.id])},observe:function(t,e,i){var n,r,s;return n=this.weakReference(t).callbacks,null==n[e]&&(n[e]=[],r=Object.getOwnPropertyDescriptor(t,e),(null!=r?r.get:void 0)||(null!=r?r.set:void 0)||(s=t[e],Object.defineProperty(t,e,{enumerable:!0,get:function(){return s},set:function(i){return function(r){var o,u,h,l,c;if(r!==s&&(i.unobserveMutations(s,t[i.id],e),s=r,u=i.weakmap[t[i.id]])){if(n=u.callbacks,n[e])for(c=n[e].slice(),h=0,l=c.length;h<l;h++)o=c[h],a.call(n[e],o)>=0&&o();return i.observeMutations(r,t[i.id],e)}}}(this)}))),a.call(n[e],i)<0&&n[e].push(i),this.observeMutations(t[e],t[this.id],e)},unobserve:function(t,e,i){var n,r,s;if((s=this.weakmap[t[this.id]])&&(n=s.callbacks[e]))return(r=n.indexOf(i))>=0&&(n.splice(r,1),n.length||(delete s.callbacks[e],this.unobserveMutations(t[e],t[this.id],e))),this.cleanupWeakReference(s,t[this.id])},get:function(t,e){return t[e]},set:function(t,e,i){return t[e]=i}},t.factory=function(e){return t.sightglass=e,t["public"]._=t,t["public"]},"object"==typeof("undefined"!=typeof module&&null!==module?module.exports:void 0)?module.exports=t.factory(require("sightglass")):"function"==typeof define&&define.amd?define(["sightglass"],function(e){return this.rivets=t.factory(e)}):this.rivets=t.factory(sightglass)}.call(this);